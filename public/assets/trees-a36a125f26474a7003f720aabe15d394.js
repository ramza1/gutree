/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(e){function t(t){var n=t||window.event,i=[].slice.call(arguments,1),r=0,a=0,s=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(r=n.wheelDelta/120),n.detail&&(r=-n.detail/3),s=r,void 0!==n.axis&&n.axis===n.HORIZONTAL_AXIS&&(s=0,a=-1*r),void 0!==n.wheelDeltaY&&(s=n.wheelDeltaY/120),void 0!==n.wheelDeltaX&&(a=-1*n.wheelDeltaX/120),i.unshift(t,r,a,s),(e.event.dispatch||e.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var i=n.length;i;)e.event.fixHooks[n[--i]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery),function(e){function t(){this===r.elem&&(r.pos=[-260,-260],r.elem=!1,a=3)}var n,i,r={pos:[-260,-260]},a=3,s=document,o=s.documentElement,c=s.body;e.event.special.mwheelIntent={setup:function(){var n=e(this).bind("mousewheel",e.event.special.mwheelIntent.handler);return this!==s&&this!==o&&this!==c&&n.bind("mouseleave",t),n=null,!0},teardown:function(){return e(this).unbind("mousewheel",e.event.special.mwheelIntent.handler).unbind("mouseleave",t),!0},handler:function(t){var s=[t.clientX,t.clientY];return this===r.elem||Math.abs(r.pos[0]-s[0])>a||Math.abs(r.pos[1]-s[1])>a?(r.elem=this,r.pos=s,a=250,clearTimeout(i),i=setTimeout(function(){a=10},200),clearTimeout(n),n=setTimeout(function(){a=3},1500),t=e.extend({},t,{type:"mwheelIntent"}),e.event.handle.apply(this,arguments)):void 0}},e.fn.extend({mwheelIntent:function(e){return e?this.bind("mwheelIntent",e):this.trigger("mwheelIntent")},unmwheelIntent:function(e){return this.unbind("mwheelIntent",e)}}),e(function(){c=s.body,e(s).bind("mwheelIntent.mwheelIntentDefault",e.noop)})}(jQuery),/*
 * jScrollPane - v2.0.0beta12 - 2012-09-27
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2010 Kelvin Luck
 * Dual licensed under the MIT or GPL licenses.
 */
function(e,t,n){e.fn.jScrollPane=function(i){function r(i,r){function a(t){var r,o,l,u,h,d,g=!1,v=!1;if(H=t,U===n)h=i.scrollTop(),d=i.scrollLeft(),i.css({overflow:"hidden",padding:0}),z=i.innerWidth()+yt,$=i.innerHeight(),i.width(z),U=e('<div class="jspPane" />').css("padding",bt).append(i.children()),W=e('<div class="jspContainer" />').css({width:z+"px",height:$+"px"}).append(U).appendTo(i);else{if(i.css("width",""),g=H.stickToBottom&&O(),v=H.stickToRight&&E(),u=i.innerWidth()+yt!=z||i.outerHeight()!=$,u&&(z=i.innerWidth()+yt,$=i.innerHeight(),W.css({width:z+"px",height:$+"px"})),!u&&wt==G&&U.outerHeight()==X)return i.width(z),void 0;wt=G,U.css("width",""),i.width(z),W.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}U.css("overflow","auto"),G=t.contentWidth?t.contentWidth:U[0].scrollWidth,X=U[0].scrollHeight,U.css("overflow",""),V=G/z,Y=X/$,J=Y>1,K=V>1,K||J?(i.addClass("jspScrollable"),r=H.maintainPosition&&(et||it),r&&(o=_(),l=A()),s(),c(),f(),r&&(x(v?G-z:o,!1),T(g?X-$:l,!1)),P(),I(),q(),H.enableKeyboardNavigation&&N(),H.clickOnTrack&&p(),L(),H.hijackInternalLinks&&R()):(i.removeClass("jspScrollable"),U.css({top:0,width:W.width()-yt}),D(),M(),B(),m()),H.autoReinitialise&&!vt?vt=setInterval(function(){a(H)},H.autoReinitialiseDelay):!H.autoReinitialise&&vt&&clearInterval(vt),h&&i.scrollTop(0)&&T(h,!1),d&&i.scrollLeft(0)&&x(d,!1),i.trigger("jsp-initialised",[K||J])}function s(){J&&(W.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),rt=W.find(">.jspVerticalBar"),at=rt.find(">.jspTrack"),Q=at.find(">.jspDrag"),H.showArrows&&(lt=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",h(0,-1)).bind("click.jsp",j),ft=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",h(0,1)).bind("click.jsp",j),H.arrowScrollOnHover&&(lt.bind("mouseover.jsp",h(0,-1,lt)),ft.bind("mouseover.jsp",h(0,1,ft))),u(at,H.verticalArrowPositions,lt,ft)),ot=$,W.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){ot-=e(this).outerHeight()}),Q.hover(function(){Q.addClass("jspHover")},function(){Q.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",j),Q.addClass("jspActive");var n=t.pageY-Q.position().top;return e("html").bind("mousemove.jsp",function(e){v(e.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",g),!1}),o())}function o(){at.height(ot+"px"),et=0,st=H.verticalGutter+at.outerWidth(),U.width(z-st-yt);try{0===rt.position().left&&U.css("margin-left",st+"px")}catch(e){}}function c(){K&&(W.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),ut=W.find(">.jspHorizontalBar"),ht=ut.find(">.jspTrack"),tt=ht.find(">.jspDrag"),H.showArrows&&(mt=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",h(-1,0)).bind("click.jsp",j),gt=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",h(1,0)).bind("click.jsp",j),H.arrowScrollOnHover&&(mt.bind("mouseover.jsp",h(-1,0,mt)),gt.bind("mouseover.jsp",h(1,0,gt))),u(ht,H.horizontalArrowPositions,mt,gt)),tt.hover(function(){tt.addClass("jspHover")},function(){tt.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",j),tt.addClass("jspActive");var n=t.pageX-tt.position().left;return e("html").bind("mousemove.jsp",function(e){y(e.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",g),!1}),dt=W.innerWidth(),l())}function l(){W.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){dt-=e(this).outerWidth()}),ht.width(dt+"px"),it=0}function f(){if(K&&J){var t=ht.outerHeight(),n=at.outerWidth();ot-=t,e(ut).find(">.jspCap:visible,>.jspArrow").each(function(){dt+=e(this).outerWidth()}),dt-=n,$-=n,z-=t,ht.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),o(),l()}K&&U.width(W.outerWidth()-yt+"px"),X=U.outerHeight(),Y=X/$,K&&(pt=Math.ceil(1/V*dt),pt>H.horizontalDragMaxWidth?pt=H.horizontalDragMaxWidth:H.horizontalDragMinWidth>pt&&(pt=H.horizontalDragMinWidth),tt.width(pt+"px"),nt=dt-pt,w(it)),J&&(ct=Math.ceil(1/Y*ot),ct>H.verticalDragMaxHeight?ct=H.verticalDragMaxHeight:H.verticalDragMinHeight>ct&&(ct=H.verticalDragMinHeight),Q.height(ct+"px"),Z=ot-ct,b(et))}function u(e,t,n,i){var r,a="before",s="after";"os"==t&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==a?s=t:t==s&&(a=t,r=n,n=i,i=r),e[a](n)[s](i)}function h(e,t,n){return function(){return d(e,t,this,n),this.blur(),!1}}function d(t,n,i,r){i=e(i).addClass("jspActive");var a,s,o=!0,c=function(){0!==t&&kt.scrollByX(t*H.arrowButtonSpeed),0!==n&&kt.scrollByY(n*H.arrowButtonSpeed),s=setTimeout(c,o?H.initialDelay:H.arrowRepeatFreq),o=!1};c(),a=r?"mouseout.jsp":"mouseup.jsp",r=r||e("html"),r.bind(a,function(){i.removeClass("jspActive"),s&&clearTimeout(s),s=null,r.unbind(a)})}function p(){m(),J&&at.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var i,r=e(this),a=r.offset(),s=t.pageY-a.top-et,o=!0,c=function(){var e=r.offset(),n=t.pageY-e.top-ct/2,a=$*H.scrollPagePercent,f=Z*a/(X-$);if(0>s)et-f>n?kt.scrollByY(-a):v(n);else{if(!(s>0))return l(),void 0;n>et+f?kt.scrollByY(a):v(n)}i=setTimeout(c,o?H.initialDelay:H.trackClickRepeatFreq),o=!1},l=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",l)};return c(),e(document).bind("mouseup.jsp",l),!1}}),K&&ht.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var i,r=e(this),a=r.offset(),s=t.pageX-a.left-it,o=!0,c=function(){var e=r.offset(),n=t.pageX-e.left-pt/2,a=z*H.scrollPagePercent,f=nt*a/(G-z);if(0>s)it-f>n?kt.scrollByX(-a):y(n);else{if(!(s>0))return l(),void 0;n>it+f?kt.scrollByX(a):y(n)}i=setTimeout(c,o?H.initialDelay:H.trackClickRepeatFreq),o=!1},l=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",l)};return c(),e(document).bind("mouseup.jsp",l),!1}})}function m(){ht&&ht.unbind("mousedown.jsp"),at&&at.unbind("mousedown.jsp")}function g(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),Q&&Q.removeClass("jspActive"),tt&&tt.removeClass("jspActive")}function v(e,t){J&&(0>e?e=0:e>Z&&(e=Z),t===n&&(t=H.animateScroll),t?kt.animate(Q,"top",e,b):(Q.css("top",e),b(e)))}function b(e){e===n&&(e=Q.position().top),W.scrollTop(0),et=e;var t=0===et,r=et==Z,a=e/Z,s=-a*(X-$);(Ct!=t||xt!=r)&&(Ct=t,xt=r,i.trigger("jsp-arrow-change",[Ct,xt,Tt,St])),k(t,r),U.css("top",s),i.trigger("jsp-scroll-y",[-s,t,r]).trigger("scroll")}function y(e,t){K&&(0>e?e=0:e>nt&&(e=nt),t===n&&(t=H.animateScroll),t?kt.animate(tt,"left",e,w):(tt.css("left",e),w(e)))}function w(e){e===n&&(e=tt.position().left),W.scrollTop(0),it=e;var t=0===it,r=it==nt,a=e/nt,s=-a*(G-z);(Tt!=t||St!=r)&&(Tt=t,St=r,i.trigger("jsp-arrow-change",[Ct,xt,Tt,St])),C(t,r),U.css("left",s),i.trigger("jsp-scroll-x",[-s,t,r]).trigger("scroll")}function k(e,t){H.showArrows&&(lt[e?"addClass":"removeClass"]("jspDisabled"),ft[t?"addClass":"removeClass"]("jspDisabled"))}function C(e,t){H.showArrows&&(mt[e?"addClass":"removeClass"]("jspDisabled"),gt[t?"addClass":"removeClass"]("jspDisabled"))}function T(e,t){var n=e/(X-$);v(n*Z,t)}function x(e,t){var n=e/(G-z);y(n*nt,t)}function S(t,n,i){var r,a,s,o,c,l,f,u,h,d=0,p=0;try{r=e(t)}catch(m){return}for(a=r.outerHeight(),s=r.outerWidth(),W.scrollTop(0),W.scrollLeft(0);!r.is(".jspPane");)if(d+=r.position().top,p+=r.position().left,r=r.offsetParent(),/^body|html$/i.test(r[0].nodeName))return;o=A(),l=o+$,o>d||n?u=d-H.verticalGutter:d+a>l&&(u=d-$+a+H.verticalGutter),u&&T(u,i),c=_(),f=c+z,c>p||n?h=p-H.horizontalGutter:p+s>f&&(h=p-z+s+H.horizontalGutter),h&&x(h,i)}function _(){return-U.position().left}function A(){return-U.position().top}function O(){var e=X-$;return e>20&&10>e-A()}function E(){var e=G-z;return e>20&&10>e-_()}function I(){W.unbind(At).bind(At,function(e,t,n,i){var r=it,a=et;return kt.scrollBy(n*H.mouseWheelSpeed,-i*H.mouseWheelSpeed,!1),r==it&&a==et})}function D(){W.unbind(At)}function j(){return!1}function P(){U.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){S(e.target,!1)})}function M(){U.find(":input,a").unbind("focus.jsp")}function N(){function t(){var e=it,t=et;switch(n){case 40:kt.scrollByY(H.keyboardSpeed,!1);break;case 38:kt.scrollByY(-H.keyboardSpeed,!1);break;case 34:case 32:kt.scrollByY($*H.scrollPagePercent,!1);break;case 33:kt.scrollByY(-$*H.scrollPagePercent,!1);break;case 39:kt.scrollByX(H.keyboardSpeed,!1);break;case 37:kt.scrollByX(-H.keyboardSpeed,!1)}return r=e!=it||t!=et}var n,r,a=[];K&&a.push(ut[0]),J&&a.push(rt[0]),U.focus(function(){i.focus()}),i.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(i){if(i.target===this||a.length&&e(i.target).closest(a).length){var s=it,o=et;switch(i.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:n=i.keyCode,t();break;case 35:T(X-$),n=null;break;case 36:T(0),n=null}return r=i.keyCode==n&&s!=it||o!=et,!r}}).bind("keypress.jsp",function(e){return e.keyCode==n&&t(),!r}),H.hideFocus?(i.css("outline","none"),"hideFocus"in W[0]&&i.attr("hideFocus",!0)):(i.css("outline",""),"hideFocus"in W[0]&&i.attr("hideFocus",!1))}function B(){i.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function L(){if(location.hash&&location.hash.length>1){var t,n,i=escape(location.hash.substr(1));try{t=e("#"+i+', a[name="'+i+'"]')}catch(r){return}t.length&&U.find(i)&&(0===W.scrollTop()?n=setInterval(function(){W.scrollTop()>0&&(S(t,!0),e(document).scrollTop(W.position().top),clearInterval(n))},50):(S(t,!0),e(document).scrollTop(W.position().top)))}}function R(){e(document.body).data("jspHijack")||(e(document.body).data("jspHijack",!0),e(document.body).delegate("a[href*=#]","click",function(n){var i,r,a,s,o,c,l=this.href.substr(0,this.href.indexOf("#")),f=location.href;if(-1!==location.href.indexOf("#")&&(f=location.href.substr(0,location.href.indexOf("#"))),l===f){i=escape(this.href.substr(this.href.indexOf("#")+1));try{r=e("#"+i+', a[name="'+i+'"]')}catch(u){return}r.length&&(a=r.closest(".jspScrollable"),s=a.data("jsp"),s.scrollToElement(r,!0),a[0].scrollIntoView&&(o=e(t).scrollTop(),c=r.offset().top,(o>c||c>o+e(t).height())&&a[0].scrollIntoView()),n.preventDefault())}}))}function q(){var e,t,n,i,r,a=!1;W.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(s){var o=s.originalEvent.touches[0];e=_(),t=A(),n=o.pageX,i=o.pageY,r=!1,a=!0}).bind("touchmove.jsp",function(s){if(a){var o=s.originalEvent.touches[0],c=it,l=et;return kt.scrollTo(e+n-o.pageX,t+i-o.pageY),r=r||Math.abs(n-o.pageX)>5||Math.abs(i-o.pageY)>5,c==it&&l==et}}).bind("touchend.jsp",function(){a=!1}).bind("click.jsp-touchclick",function(){return r?(r=!1,!1):void 0})}function F(){var e=A(),t=_();i.removeClass("jspScrollable").unbind(".jsp"),i.replaceWith(_t.append(U.children())),_t.scrollTop(e),_t.scrollLeft(t),vt&&clearInterval(vt)}var H,U,z,$,W,G,X,V,Y,J,K,Q,Z,et,tt,nt,it,rt,at,st,ot,ct,lt,ft,ut,ht,dt,pt,mt,gt,vt,bt,yt,wt,kt=this,Ct=!0,Tt=!0,xt=!1,St=!1,_t=i.clone(!1,!1).empty(),At=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";bt=i.css("paddingTop")+" "+i.css("paddingRight")+" "+i.css("paddingBottom")+" "+i.css("paddingLeft"),yt=(parseInt(i.css("paddingLeft"),10)||0)+(parseInt(i.css("paddingRight"),10)||0),e.extend(kt,{reinitialise:function(t){t=e.extend({},H,t),a(t)},scrollToElement:function(e,t,n){S(e,t,n)},scrollTo:function(e,t,n){x(e,n),T(t,n)},scrollToX:function(e,t){x(e,t)},scrollToY:function(e,t){T(e,t)},scrollToPercentX:function(e,t){x(e*(G-z),t)},scrollToPercentY:function(e,t){T(e*(X-$),t)},scrollBy:function(e,t,n){kt.scrollByX(e,n),kt.scrollByY(t,n)},scrollByX:function(e,t){var n=_()+Math[0>e?"floor":"ceil"](e),i=n/(G-z);y(i*nt,t)},scrollByY:function(e,t){var n=A()+Math[0>e?"floor":"ceil"](e),i=n/(X-$);v(i*Z,t)},positionDragX:function(e,t){y(e,t)},positionDragY:function(e,t){v(e,t)},animate:function(e,t,n,i){var r={};r[t]=n,e.animate(r,{duration:H.animateDuration,easing:H.animateEase,queue:!1,step:i})},getContentPositionX:function(){return _()},getContentPositionY:function(){return A()},getContentWidth:function(){return G},getContentHeight:function(){return X},getPercentScrolledX:function(){return _()/(G-z)},getPercentScrolledY:function(){return A()/(X-$)},getIsScrollableH:function(){return K},getIsScrollableV:function(){return J},getContentPane:function(){return U},scrollToBottom:function(e){v(Z,e)},hijackInternalLinks:e.noop,destroy:function(){F()}}),a(r)}return i=e.extend({},e.fn.jScrollPane.defaults,i),e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){i[this]=i[this]||i.speed}),this.each(function(){var t=e(this),n=t.data("jsp");n?n.reinitialise(i):(e("script",t).filter('[type="text/javascript"],:not([type])').remove(),n=new r(t,i),t.data("jsp",n))})},e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),function(e){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}),e.fn.item=function(){var t=e(this).tmplItem().data;return e.isFunction(t.reload)?t.reload():null},e.fn.forItem=function(t){return this.filter(function(){var n=e(this).tmplItem().data;return t.eql&&t.eql(n)||t===n?!0:void 0})},e.fn.autolink=function(){return this.each(function(){var t=/((http|https|ftp):\/\/[\w?=&.\/-;#~%-]+(?![\w\s?&.\/;#~%"=-]*>))/g;e(this).html(e(this).html().replace(t,'<a href="$1">$1</a> '))})},e.fn.mailto=function(){return this.each(function(){var t=/(([a-z0-9*._+]){1,}\@(([a-z0-9]+[-]?){1,}[a-z0-9]+\.){1,}([a-z]{2,4}|museum)(?![\w\s?&.\/;#~%"=-]*>))/g;e(this).html(e(this).html().replace(t,'<a href="mailto:$1">$1</a>'))})},e.fn.imagesLoaded=function(e){function t(){e.call(a,i)}function n(){0>=--r&&this.src!==s&&(setTimeout(t),i.unbind("load error",n))}var i=this.find("img"),r=i.length,a=this,s="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return r||t(),i.bind("load error",n).each(function(){if(this.complete||void 0===this.complete){var e=this.src;this.src=s,this.src=e}}),this},e.fn.addScrollExtension=function(){var t=this.jScrollPane({verticalGutter:-9}),n={extPluginOpts:{mouseLeaveFadeSpeed:500,hovertimeout_t:1e3,useTimeout:!1,deviceWidth:980},hovertimeout:null,isScrollbarHover:!1,elementtimeout:null,isScrolling:!1,addHoverFunc:function(){if(e(window).width()<=this.extPluginOpts.deviceWidth)return!1;var n=this;e.fn.jspmouseenter=e.fn.show,e.fn.jspmouseleave=e.fn.fadeOut;var i=this.getContentPane().siblings(".jspVerticalBar").hide();t.bind("mouseenter.jsp",function(){return i.stop(!0,!0).jspmouseenter(),n.extPluginOpts.useTimeout?(clearTimeout(n.hovertimeout),n.hovertimeout=setTimeout(function(){n.isScrolling||i.stop(!0,!0).jspmouseleave(n.extPluginOpts.mouseLeaveFadeSpeed||0)},n.extPluginOpts.hovertimeout_t),void 0):!1}).bind("mouseleave.jsp",function(){n.extPluginOpts.useTimeout?(clearTimeout(n.elementtimeout),n.isScrolling||i.stop(!0,!0).jspmouseleave(n.extPluginOpts.mouseLeaveFadeSpeed||0)):i.stop(!0,!0).jspmouseleave(n.extPluginOpts.mouseLeaveFadeSpeed||0)}),this.extPluginOpts.useTimeout&&(t.bind("scrollstart.jsp",function(){clearTimeout(n.hovertimeout),n.isScrolling=!0,i.stop(!0,!0).jspmouseenter()}).bind("scrollstop.jsp",function(){clearTimeout(n.hovertimeout),n.isScrolling=!1,n.hovertimeout=setTimeout(function(){n.isScrollbarHover||i.stop(!0,!0).jspmouseleave(n.extPluginOpts.mouseLeaveFadeSpeed||0)},n.extPluginOpts.hovertimeout_t)}),e("<div/>").css({position:"absolute",left:i.css("left"),top:i.css("top"),right:i.css("right"),bottom:i.css("bottom"),width:i.width(),height:i.height()}).bind("mouseenter.jsp",function(){clearTimeout(n.hovertimeout),clearTimeout(n.elementtimeout),n.isScrollbarHover=!0,n.elementtimeout=setTimeout(function(){i.stop(!0,!0).jspmouseenter()},100)}).bind("mouseleave.jsp",function(){clearTimeout(n.hovertimeout),n.isScrollbarHover=!1,n.hovertimeout=setTimeout(function(){n.isScrolling||i.stop(!0,!0).jspmouseleave(n.extPluginOpts.mouseLeaveFadeSpeed||0)},n.extPluginOpts.hovertimeout_t)}))}},i=t.data().jsp;return t.find(".jspVerticalBar").css({opacity:"0.8"}),e.extend(!0,i,n),i.addHoverFunc(),i}}(jQuery),function(e){e.ajaxTransport("+*",function(e){var t;return e.useXHR2?{send:function(n,r){t=e.xhr(),t.open(e.type,e.url,e.async),delete n["Content-Type"],n["X-Requested-With"]="XMLHttpRequest";for(i in n)t.setRequestHeader(i,n[i]);var a=function(){var e={xml:t.responseXML,text:t.responseText};r(t.status,t.statusText,e,t.getAllResponseHeaders())};t.addEventListener("load",a),t.addEventListener("error",a),e.progress&&t.addEventListener("progress",e.progress),e.upload&&e.upload.success&&t.upload.addEventListener("load",e.upload.load),e.upload&&e.upload.progress&&t.upload.addEventListener("progress",e.upload.progress),t.send(e.data)},abort:function(){t&&t.abort()}}:void 0});var t={processData:!1,contentType:!1,type:"POST",useXHR2:!0,upload:{}};e.upload=function(n,i,r){var a=new FormData;i instanceof File&&(i={file:i});for(var s in i)a.append(s,i[s]);return"function"==typeof r&&(r={success:r}),r.url=n,r.data=a,r=e.extend({},t,r),e.ajax(r)}}(jQuery),function(e){function t(t,n,i,r){var a={data:r||(n?n.data:{}),_wrap:n?n._wrap:null,tmpl:null,parent:n||null,nodes:[],calls:l,nest:f,wrap:u,html:h,update:d};return t&&e.extend(a,t,{nodes:[],parent:n}),i&&(a.tmpl=i,a._ctnt=a._ctnt||a.tmpl(e,a),a.key=++k,(T.length?y:b)[k]=a),a}function n(t,r,a){var s,o=a?e.map(a,function(e){return"string"==typeof e?t.key?e.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+g+'="'+t.key+'" $2'):e:n(e,t,e._ctnt)}):t;return r?o:(o=o.join(""),o.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(t,n,r,a){s=e(r).get(),c(s),n&&(s=i(n).concat(s)),a&&(s=s.concat(i(a)))}),s?s:i(o))}function i(t){var n=document.createElement("div");return n.innerHTML=t,e.makeArray(n.childNodes)}function r(t){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+e.trim(t).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(t,n,i,r,a,o,c){var l,f,u,h=e.tmpl.tag[i];if(!h)throw"Template command not found: "+i;return l=h._default||[],o&&!/\w$/.test(a)&&(a+=o,o=""),a?(a=s(a),c=c?","+s(c)+")":o?")":"",f=o?a.indexOf(".")>-1?a+o:"("+a+").call($item"+c:a,u=o?f:"(typeof("+a+")==='function'?("+a+").call($item):("+a+"))"):u=f=l.$1||"null",r=s(r),"');"+h[n?"close":"open"].split("$notnull_1").join(a?"typeof("+a+")!=='undefined' && ("+a+")!=null":"true").split("$1a").join(u).split("$1").join(f).split("$2").join(r?r.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(e,t,n,i){return i=i?","+i+")":n?")":"",i?"("+t+").call($item"+i:e}):l.$2||"")+"_.push('"})+"');}return _;")}function a(t,i){t._wrap=n(t,!0,e.isArray(i)?i:[v.test(i)?i:e(i).html()]).join("")}function s(e){return e?e.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function o(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}function c(n){function i(n){function i(e){e+=l,s=f[e]=f[e]||t(s,b[s.parent.key+l]||s.parent,null,!0)}var r,a,s,o,c=n;if(o=n.getAttribute(g)){for(;c.parentNode&&1===(c=c.parentNode).nodeType&&!(r=c.getAttribute(g)););r!==o&&(c=c.parentNode?11===c.nodeType?0:c.getAttribute(g)||0:0,(s=b[o])||(s=y[o],s=t(s,b[c]||y[c],null,!0),s.key=++k,b[k]=s),C&&i(o)),n.removeAttribute(g)}else C&&(s=e.data(n,"tmplItem"))&&(i(s.key),b[s.key]=s,c=e.data(n.parentNode,"tmplItem"),c=c?c.key:0);if(s){for(a=s;a&&a.key!=c;)a.nodes.push(n),a=a.parent;delete s._ctnt,delete s._wrap,e.data(n,"tmplItem",s)}}var r,a,s,o,c,l="_"+C,f={};for(s=0,o=n.length;o>s;s++)if(1===(r=n[s]).nodeType){for(a=r.getElementsByTagName("*"),c=a.length-1;c>=0;c--)i(a[c]);i(r)}}function l(e,t,n,i){return e?(T.push({_:e,tmpl:t,item:this,data:n,options:i}),void 0):T.pop()}function f(t,n,i){return e.tmpl(e.template(t),n,i,this)}function u(t,n){var i=t.options||{};return i.wrapped=n,e.tmpl(e.template(t.tmpl),t.data,i,t.item)}function h(t,n){var i=this._wrap;return e.map(e(e.isArray(i)?i.join(""):i).filter(t||"*"),function(e){return n?e.innerText||e.textContent:e.outerHTML||o(e)})}function d(){var t=this.nodes;e.tmpl(null,null,null,this).insertBefore(t[0]),e(t).remove()}var p,m=e.fn.domManip,g="_tmplitem",v=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},y={},w={key:0,data:{}},k=0,C=0,T=[];e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){e.fn[t]=function(i){var r,a,s,o,c=[],l=e(i),f=1===this.length&&this[0].parentNode;if(p=b||{},f&&11===f.nodeType&&1===f.childNodes.length&&1===l.length)l[n](this[0]),c=this;else{for(a=0,s=l.length;s>a;a++)C=a,r=(a>0?this.clone(!0):this).get(),e.fn[n].apply(e(l[a]),r),c=c.concat(r);C=0,c=this.pushStack(c,t,l.selector)}return o=p,p=null,e.tmpl.complete(o),c}}),e.fn.extend({tmpl:function(t,n,i){return e.tmpl(this[0],t,n,i)},tmplItem:function(){return e.tmplItem(this[0])},template:function(t){return e.template(t,this[0])},domManip:function(t,n,i){if(t[0]&&t[0].nodeType){for(var r,a=e.makeArray(arguments),s=t.length,o=0;s>o&&!(r=e.data(t[o++],"tmplItem")););s>1&&(a[0]=[e.makeArray(t)]),r&&C&&(a[2]=function(t){e.tmpl.afterManip(this,t,i)}),m.apply(this,a)}else m.apply(this,arguments);return C=0,!p&&e.tmpl.complete(b),this}}),e.extend({tmpl:function(i,r,s,o){var c,l=!o;if(l)o=w,i=e.template[i]||e.template(null,i),y={};else if(!i)return i=o.tmpl,b[o.key]=o,o.nodes=[],o.wrapped&&a(o,o.wrapped),e(n(o,null,o.tmpl(e,o)));return i?("function"==typeof r&&(r=r.call(o||{})),s&&s.wrapped&&a(s,s.wrapped),c=e.isArray(r)?e.map(r,function(e){return e?t(s,o,i,e):null}):[t(s,o,i,r)],l?e(n(o,null,c)):c):[]},tmplItem:function(t){var n;for(t instanceof e&&(t=t[0]);t&&1===t.nodeType&&!(n=e.data(t,"tmplItem"))&&(t=t.parentNode););return n||w},template:function(t,n){return n?("string"==typeof n?n=r(n):n instanceof e&&(n=n[0]||{}),n.nodeType&&(n=e.data(n,"tmpl")||e.data(n,"tmpl",r(n.innerHTML))),"string"==typeof t?e.template[t]=n:n):t?"string"!=typeof t?e.template(null,t):e.template[t]||e.template(null,v.test(t)?t:e(t)):null},encode:function(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),e.extend(e.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(t,n,i){var r=11===n.nodeType?e.makeArray(n.childNodes):1===n.nodeType?[n]:[];i.call(t,n),c(r),C++}})}(jQuery),function(){var e;e="undefined"!=typeof exports?exports:this.Spine={},e.version="0.0.3";var t=e.$=this.jQuery||this.Zepto,n=e.makeArray=function(e){return Array.prototype.slice.call(e,0)},i=e.Events={bind:function(e,t){var n=e.split(" ");this._callbacks||(this._callbacks={});for(var i=0;n.length>i;i++)(this._callbacks[n[i]]||(this._callbacks[n[i]]=[])).push(t);return this},trigger:function(){var e,t,i,r,a=n(arguments),s=a.shift();if(!(t=this._callbacks))return this;if(!(e=this._callbacks[s]))return this;for(i=0,r=e.length;r>i;i++)if(e[i].apply(this,a)===!1)return!1;return this},unbind:function(e,t){if(!e)return this._callbacks={},this;var n,i,r,a;if(!(i=this._callbacks))return this;if(!(n=this._callbacks[e]))return this;for(r=0,a=n.length;a>r;r++)if(t===n[r]){n.splice(r,1);break}return this}},r=e.Log={trace:!0,logPrefix:"(App)",log:function(){if(this.trace&&"undefined"!=typeof console){var e=n(arguments);return this.logPrefix&&e.unshift(this.logPrefix),console.log.apply(console,e),this}}};"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t});var a=["included","extended"],s=e.Class={inherited:function(){},created:function(){},prototype:{initializer:function(){},init:function(){}},create:function(e,t){var n=Object.create(this);return n.parent=this,n.prototype=n.fn=Object.create(this.prototype),e&&n.include(e),t&&n.extend(t),n.created(),this.inherited(n),n},init:function(){var e=Object.create(this.prototype);return e.parent=this,e.initializer.apply(e,arguments),e.init.apply(e,arguments),e},proxy:function(e){var t=this;return function(){return e.apply(t,arguments)}},proxyAll:function(){for(var e=n(arguments),t=0;e.length>t;t++)this[e[t]]=this.proxy(this[e[t]])},include:function(e){for(var t in e)-1==a.indexOf(t)&&(this.fn[t]=e[t]);var n=e.included;return n&&n.apply(this),this},extend:function(e){for(var t in e)-1==a.indexOf(t)&&(this[t]=e[t]);var n=e.extended;return n&&n.apply(this),this}};s.prototype.proxy=s.proxy,s.prototype.proxyAll=s.proxyAll,s.inst=s.init,e.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)}).toUpperCase()};var o=e.Model=s.create();o.extend(i),o.createSub=o.create,o.setup=function(e,t){var n=o.createSub();return e&&(n.name=e),t&&(n.attributes=t),n},o.extend({created:function(){this.records={},this.attributes=[],this.bind("create",this.proxy(function(e){this.trigger("change","create",e)})),this.bind("update",this.proxy(function(e){this.trigger("change","update",e)})),this.bind("destroy",this.proxy(function(e){this.trigger("change","destroy",e)}))},find:function(e){var t=this.records[e];if(!t)throw"Unknown record";return t.dup()},exists:function(e){try{return this.find(e)}catch(t){return!1}},refresh:function(e){this.records={};for(var t=0,n=e.length;n>t;t++){var i=this.init(e[t]);i.newRecord=!1,this.records[i.id]=i}this.trigger("refresh")},select:function(e){var t=[];for(var n in this.records)e(this.records[n])&&t.push(this.records[n]);return this.dupArray(t)},findByAttribute:function(e,t){for(var n in this.records)if(this.records[n][e]==t)return this.records[n].dup()},findAllByAttribute:function(e,t){return this.select(function(n){return n[e]==t})},each:function(e){for(var t in this.records)e(this.records[t])},all:function(){return this.dupArray(this.recordsValues())},first:function(){var e=this.recordsValues()[0];return e&&e.dup()},last:function(){var e=this.recordsValues(),t=e[e.length-1];return t&&t.dup()},count:function(){return this.recordsValues().length},deleteAll:function(){for(var e in this.records)delete this.records[e]},destroyAll:function(){for(var e in this.records)this.records[e].destroy()},update:function(e,t){this.find(e).updateAttributes(t)},create:function(e){var t=this.init(e);return t.save(),t},destroy:function(e){this.find(e).destroy()},sync:function(e){this.bind("change",e)},fetch:function(e){e?this.bind("fetch",e):this.trigger("fetch")},toJSON:function(){return this.recordsValues()},recordsValues:function(){var e=[];for(var t in this.records)e.push(this.records[t]);return e},dupArray:function(e){for(var t=[],n=0;e.length>n;n++)t.push(e[n].dup());return t}}),o.include({model:!0,newRecord:!0,init:function(e){e&&this.load(e)},isNew:function(){return this.newRecord},validate:function(){},load:function(e){for(var t in e)this[t]=e[t]},attributes:function(){for(var e={},t=0;this.parent.attributes.length>t;t++){var n=this.parent.attributes[t];e[n]=this[n]}return e.id=this.id,e},eql:function(e){return e&&e.id===this.id&&e.parent===this.parent},save:function(){var e=this.validate();if(e&&!this.trigger("error",e))throw"Validation failed: "+e;this.trigger("beforeSave"),this.newRecord?this.create():this.update(),this.trigger("save")},updateAttribute:function(e,t){return this[e]=t,this.save()},updateAttributes:function(e){return this.load(e),this.save()},destroy:function(){this.trigger("beforeDestroy"),delete this.parent.records[this.id],this.trigger("destroy")},dup:function(){var e=this.parent.init(this.attributes());return e.newRecord=this.newRecord,e},reload:function(){return this.parent.find(this.id)},toJSON:function(){return this.attributes()},exists:function(){return this.id&&this.id in this.parent.records},update:function(){this.trigger("beforeUpdate"),this.parent.records[this.id]=this.dup(),this.trigger("update")},create:function(){this.trigger("beforeCreate"),this.id||(this.id=e.guid()),this.newRecord=!1,this.parent.records[this.id]=this.dup(),this.trigger("create")},bind:function(e,t){this.parent.bind(e,this.proxy(function(e){e&&this.eql(e)&&t.apply(this,arguments)}))},trigger:function(){var e=n(arguments);e.splice(1,0,this),this.parent.trigger.apply(this.parent,e)}});var c=/^(\w+)\s*(.*)$/,l=e.Controller=s.create({tag:"div",initializer:function(e){this.options=e;for(var n in this.options)this[n]=this.options[n];this.el||(this.el=document.createElement(this.tag)),this.el=t(this.el),this.events||(this.events=this.parent.events),this.elements||(this.elements=this.parent.elements),this.events&&this.delegateEvents(),this.elements&&this.refreshElements(),this.proxied&&this.proxyAll.apply(this,this.proxied)},$:function(e){return t(e,this.el)},delegateEvents:function(){for(var e in this.events){var t=this.events[e],n=this.proxy(this[t]),i=e.match(c),r=i[1],a=i[2];""===a?this.el.bind(r,n):this.el.delegate(a,r,n)}},refreshElements:function(){for(var e in this.elements)this[this.elements[e]]=this.$(e)},delay:function(e,t){setTimeout(this.proxy(e),t||0)}});l.include(i),l.include(r),e.App=l.create({create:function(e){return this.parent.include(e),this}}).init(),l.fn.App=e.App}();var BranchItem=Spine.Model.setup("IssueItem",["id","Branch_url","created_time_ago","created_at","name","icon_url","memberships_count","sub_tree_size","tree_id","latest","collection_url"]);BranchItem.extend({base_url:"http://localhost:3000/branches/all",get:function(e,t,n,i){$.ajax({type:"GET",url:e,contentType:"application/json",data:i,success:t,error:n})},fakeItem:function(){return{Branch_url:"",created_time_ago:"1 minute ago",memberships_count:"40",sub_tree_size:"0",latest_tip:"The Beginning of time",icon_url:"/assets/image_7.jpg",collection_url:"http://localhost:3000/trees/2/all_branches"}}}),jQuery(function(e){window.BrowsePhoto=Spine.Controller.create({elements:{},events:{},proxied:["activate","deactivate","onMouseOver","change"],template:function(){},init:function(){this.input=e("<input type='file'  multiple accept='image/*'>"),this.input.css({position:"fixed","z-index":1060,cursor:"pointer","-moz-opacity":"0",filter:"alpha(opacity: 0)",opacity:"0"}),this.input.mouseover(this.proxy(function(){this.el.addClass("upload_btn-hover")})),this.input.mouseout(this.proxy(function(){this.el.removeClass("upload_btn-hover"),this.input.detach()})),this.input.focus(this.proxy(function(){this.el.addClass("upload_btn-focus")})),this.input.blur(this.proxy(function(){this.el.removeClass("upload_btn-focus")})),console.log(this.el)},deActivate:function(){this.input.off("change"),this.el.off("mouseover"),console.log("deActivate")},activate:function(){console.log("input",this.input),this.input.on("change",this.change),this.el.on("mouseover",this.onMouseOver),console.log("activate")},change:function(e){return console.log("change"),this.onChange&&this.onChange.call(null,e),!1},onMouseOver:function(){return this.input.offset(this.el.offset()),this.input.width(this.el.outerWidth()),this.input.height(this.el.outerHeight()),e("body").append(this.input),!1}})}),jQuery(function(e){window.ProfilePhotoUpload=Spine.Controller.create({elements:{" .status":"progressStatus",".progress  .bar":"progressBar"},events:{},proxied:["upload","onUpload","uploadProgress","uploadError","uploadSuccess"],template:function(){},init:function(){},show:function(){this.el.html(this.render()),this.status=this.el.find(".status"),this.progressBar=this.el.find(".bar")
},render:function(){return e("#post-upload-progress-tmpl").tmpl("")},upload:function(t,n,i,r){console.log("upload",n[0]),this.files=n,this.succCallback=i,this.errorCallback=r,this.show(),e.upload(t,{photo:n[0]},{contentType:"JSON",upload:{progress:this.uploadProgress,load:this.onUpload},error:this.uploadError,success:this.uploadSuccess})},uploadSuccess:function(e){console.log("success",e),this.succCallback&&this.succCallback.call(null,e),this.el.empty()},uploadError:function(e){this.showError(),this.errorCallback&&this.errorCallback.call(null,e)},uploadProgress:function(e){percentage=Math.round(100*(e.position/e.total)),console.log("progress",e),this.status&&this.status.text("uploading..."+percentage+"%"),this.progressBar&&this.progressBar.css({width:percentage+"%"})},onUpload:function(e){console.log("load",e)},uploadPhoto:function(){this.uploadPhotos.show()},showError:function(){this.el.html(e("#post-upload-error-tmpl").tmpl(""))}})}),jQuery(function(e){window.NewBranch=Spine.Controller.create({elements:{"#name_el":"nameEl","#branch_name":"branchName","#branch_private":"type","#new_branch_form":"newBranchForm","#branch_tree_id":"treeId",".create":"createButton",".cancel":"cancel",".ui-btn":"btns",".new_branch_form_container":"newBranchFormContainer"},events:{"submit #new_branch_form":"create","click .ui-btn":"click","click .cancel":"cancel","keyup #branch_name":"checkAvailability"},proxied:["render","activate","deActivate","success","failure"],template:function(){},init:function(){this.minChars=this.minChars||1,e("#newBranchDialog").bind("branch:new",this.proxy(function(e,t){console.log("error el",t),this.render(t)}))},show:function(){console.log("show tip branch",this.newBranchForm)},click:function(t){var n=e(t.currentTarget);this.btns.removeClass("active"),n.addClass("active"),n.hasClass("private")?this.type.val("true"):this.type.val("false"),this.nameEl.hide().show(),console.log(this.type)},checkAvailability:function(t){n=e(t.target).val(),console.log("query",n);var n=n.toLowerCase();n&&n.length?n.length>=this.minChars?(this.createButton.removeClass("disabled"),this.showHint("checking availability"),data={},data.tree_id=this.treeId.val(),data.q=n,e.ajax({type:"GET",url:"/branches_available.json",data:data,error:this.proxy(function(e){console.log(e),this.showHint(e.error),this.nameEl.find(".control-group").addClass("error")}),success:this.proxy(function(e){console.log(e),e.available?(this.showHint('<i class="icon-ok"></i> available'),this.nameEl.find(".control-group").addClass("success")):(this.showHint("unavailable"),this.nameEl.find(".control-group").addClass("warning"))})})):this.createButton.addClass("disabled"):(this.createButton.addClass("disabled"),this.hideHint(),this.nameEl.find(".control-group").removeClass("success").removeClass("error").removeClass("warning"))},showHint:function(t){this.hideHint(),e('<span class="help-inline hint">'+t+"</span>").insertAfter(this.branchName)},hideHint:function(){this.nameEl.find(".hint").remove()},activate:function(){this.el.modal()},deActivate:function(){this.el.modal("hide")},create:function(t){return this.createButton.hasClass("disabled")?!1:(url=e(t.target).attr("action"),console.log("target",e(t)),console.log("submit",url),data=e(t.target).serialize(),e.ajax({type:"POST",url:url+".js",data:data,error:this.failure,success:this.success}),this.createButton.button("loading"),!1)},render:function(e){this.newBranchFormContainer.html(e),this.newBranchForm=this.el.find("#new_branch_form"),this.nameEl=this.newBranchForm.find("#name_el"),this.type=this.newBranchForm.find("#branch_private"),this.treeId=this.newBranchForm.find("#branch_tree_id"),this.createButton=this.newBranchForm.find(".create"),this.cancel=this.newBranchForm.find(".cancel"),this.btns=this.newBranchForm.find(".ui-btn")},success:function(){this.el.modal("hide"),this.createButton.addClass("disabled"),this.createButton.button("complete"),this.hideHint(),this.nameEl.find(".control-group").removeClass("success error warning")},failure:function(e){console.log("error",e.responseText),this.createButton.button("complete"),this.createButton.addClass("disabled"),this.nameEl.find(".control-group").addClass("error")},cancel:function(){return this.xhr&&4!=this.xhr.readystate&&this.xhr.abort(),this.createButton.button("complete"),this.el.modal("hide"),this.hideHint(),!1}})}),jQuery(function(){window.UploadPhotos=Spine.Controller.create({elements:{"#name_el":"nameEl","#tip_branch_private":"type",".ui-btn":"btns"},events:{"click .ui-btn":"click","keyup #tip_branch_name":"checkAvailability"},proxied:["activate","deactivate"],template:function(){},init:function(){},show:function(){this.el.show()},uploadPhoto:function(){}})}),jQuery(function($){window.EditBranch=Spine.Controller.create({elements:{"#edit_modal":"modalView","#pick":"pick","#edit_modal_body":"modalBody","#edit_photo_preview":"photoTrigger",".prev_status":"prevStatus",".save":"saveBtn"},events:{"click #edit_photo_preview.enable":"showPhoto","click .close_edit_pane":"hide","click .skip_welcome":"skipWelcome","click .loading-dialog":"hideProgress","submit form.edit_branch":"save","dragenter #pick":"dragEnter","dragover #pick":"dragOver","dragleave #pick":"dragLeave","drop #pick":"drop"},proxied:["activate","deactivate","show","getEditView","change","uploadPhoto","onUpload","uploadError","save"],template:function(){},init:function(){console.log("init edit",this.pick),this.App.bind("branch:edit",this.getEditView)},show:function(){this.el.show()},hideProgress:function(){this.progress&&(this.progress.modal("hide"),this.progress.remove(),this.progress=null)},showProgress:function(e){this.progress=$("#loading-dialog-tmpl").tmpl({message:e}).appendTo(this.el.parent()),this.progress.modal({backdrop:"static",keyboard:!1}),this.progress.addClass("loading")},getEditView:function(url,elem){this.elem=elem,this.showProgress("loading..."),$.ajax({type:"GET",url:url,error:this.proxy(function(data){console.log(eval(data)),this.progress.removeClass("success warning loading").addClass("error").find(".message").html('<i class="icon-warning-sign"></i>  Error Loading data')}),success:this.proxy(function(e){this.hideProgress(),this.render(e)})})},render:function(data){this.el=eval(data),this.el.find(".modal-header").html('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),this.profileUpload=this.el.find("#profile_upload_photo"),this.photoPicker=this.el.find(".photo_chooser"),this.profileUploadPreview=this.el.find("#profile_upload_photo_preview"),console.log("profileUpload",this.profileUpload),this.profilePhotoUpload=ProfilePhotoUpload.init({el:this.profileUpload}),this.browsePhoto=BrowsePhoto.init({el:this.photoPicker,onChange:this.uploadPhoto}),this.browsePhoto.activate(),this.uploadUrl=this.profileUpload.data("upload_url"),this.dialog=this.el.find(".modal-form").addClass("modal hide fade").removeClass("no-shadow").modal(),this.saveBtn=this.dialog.find(".save"),this.dialog.find(".listbuilderinput ").listbuilder({width:"100%",url:"/tags",jsonContainer:"tags",hintText:"type a name and press enter or comma."}),this.dialog.find(".popover_trigger").popover({trigger:"hover"})},save:function(ev){return this.saveBtn.hasClass("disabled")?void 0:(url=$(ev.target).data("url"),console.log("target",$(ev)),console.log("submit",url),data=$(ev.target).serialize(),$.ajax({type:"PUT",url:url,data:data,error:this.proxy(function(data){this.saveBtn.removeClass("disabled"),console.log(eval(data)),this.render(data)}),success:this.proxy(function(data){this.saveBtn.removeClass("disabled"),eval(data),this.close()})}),this.saveBtn.addClass("disabled"),!1)},uploadPhoto:function(e){event=e.originalEvent,this.files=event.target.files,this.files.length>0&&(this.photoPicker.addClass("disabled"),this.browsePhoto.deActivate(),this.profilePhotoUpload.upload(this.uploadUrl,this.files,this.onUpload,this.uploadError))},uploadError:function(){this.photoPicker.removeClass("disabled").removeClass("active"),this.browsePhoto.activate(),this.showPhotoPreview()},onUpload:function(e){console.log("data",e),this.photoPicker.removeClass("disabled").removeClass("active"),this.browsePhoto.activate(),this.showPhotoPreview(e.photo_url)},showPhotoPreview:function(e){var t=$("#post-upload-preview-tmpl").tmpl({src:e}),n=this.profileUploadPreview.html(t).find(".image-container"),i=this.profileUploadPreview.find(".loading_pane");i.show(),this.profileUploadPreview.hide(),n.imagesLoaded(this.proxy(function(){i.hide(),n.append('<span class="prev_status">change photo_tips</span>'),preview=this.profileUploadPreview.find(".preview"),this.photoPicker.hide().replaceWith(preview),this.photoPicker=preview,this.photoPicker.show(),this.browsePhoto.deActivate(),this.browsePhoto=BrowsePhoto.init({el:this.photoPicker,onChange:this.uploadPhoto}),this.browsePhoto.activate(),console.log(this.photoPicker),this.profileUploadPreview.empty()}))},dragOver:function(e){e.stopPropagation(),e.preventDefault(),this.pick.addClass("active")},drop:function(e){e.stopPropagation(),e.preventDefault(),event=e.originalEvent,console.log("e",event.dataTransfer);var t=event.dataTransfer,n=t.files;console.log("drop",n),this.pick.addClass("active")},dragLeave:function(e){e.stopPropagation(),e.preventDefault(),this.pick.removeClass("active")},dragEnter:function(e){e.stopPropagation(),e.preventDefault(),this.pick.addClass("active")},close:function(){this.dialog&&this.dialog.modal("hide")},skipWelcome:function(){this.close()}})}),jQuery(function(e){window.BranchList=Spine.Controller.create({elements:{".items":"itemsEl",".items .item":"handler",".progress":"progress",".load":"load"},events:{"click .items .item a":"click","click .dropdown-toggle":"dropdown"},proxied:["render","addOne","show","addAll","prefetchComplete","onError","initGrid","update"],init:function(){this.items=[],this.empty=!1,this.gridOptions={autoResize:!0,container:e("#main"),offset:20,itemWidth:236},this.handler.imagesLoaded(this.initGrid),this.handler.each(this.proxy(function(e){BranchItemController.init({el:this.handler[e]})})),e("#branches").bind("branches:create",this.proxy(function(e,t){console.log("create",e),this.addOne(t)})),this.App.bind("branches:update",this.update)},initGrid:function(){this.handler=this.itemsEl.find(".item"),this.handler.wookmark(this.gridOptions)},clearGrid:function(){this.handler.wookmarkClear()},template:function(){},update:function(){this.clearGrid(),this.initGrid(),console.log("refresh")},create:function(e,t){this.addOne(t)},addOne:function(e){if(this.checkItem(e)){console.log("item",e);try{BranchItemController.init({el:e.el}),this.itemsEl.prepend(e.el),this.clearGrid(),this.initGrid()}catch(t){console.log(t)}}},show:function(){this.prefetching||this.render()},render:function(){return this.itemsEl.empty(),1==this.empty?(this.showEmptyMessage(),void 0):(this.items=BranchItem.findAllByAttribute("collection_url",this.itemCollectionUrl),this.items.length>0?this.addAll():(this.showProgress({message:"loading..."}),this.prefetch()),void 0)},update:function(){console.log("update"),this.clearGrid(),this.initGrid()},hideProgress:function(){this.progress&&this.progress.remove()},showProgress:function(t){this.hideProgress(),this.progress=e("#progress-tmpl").tmpl(t),this.progress.appendTo(this.el)},showLoadProgress:function(t){this.hideLoadProgress(),this.loadProgress=e("#load-progress-tmpl").tmpl(t),this.loadProgress.appendTo(this.el)},hideLoadProgress:function(){this.loadProgress&&this.loadProgress.remove()},loadMore:function(){this.prefetching||(this.showLoadProgress(),this.prefetch())},addAll:function(){e.each(this.items,this.proxy(function(e){this.addOne(this.items[e])}))},prefetch:function(){this.prefetching||(this.prefetching=!0,IssueItem.get(this.itemCollectionUrl,this.prefetchComplete,this.onError,this.params))},prefetchComplete:function(e){return console.log(e),this.hideProgress(),this.hideLoadProgress(),this.prefetching=!1,this.params=e.params,this.remaining=e.remaining,this.empty=e.empty,this.empty?(this.showEmptyMessage(),void 0):(this.createItems(e.issues),void 0)},dropdown:function(t){this.dropDown=e(t.currentTarget)},click:function(t){this.currentAnchor=e(t.currentTarget),this.itemsEl.find("li.active").removeClass("active"),this.current=e(t.currentTarget).closest("li"),this.current.addClass("active"),this.currentAnchor.focus(),console.log("click",this.currentAnchor)},checkItem:function(e){return this.itemCollectionUrl===e.collection_url},createItems:function(t){e.each(t,this.proxy(function(e){item=IssueItem.create(t[e])}))},onError:function(e){console.log("error",e),this.hideProgress(),this.hideLoadProgress(),this.prefetching=!1},shouldScroll:function(t){var n=!1;return this.el[0].scrollHeight>0&&(n=0>=this.el[0].scrollHeight-t-e(document).scrollTop()),n},scroll:function(e){var t=this.shouldScroll(e);console.log("shouldScroll",t),t&&this.loadMore()}})}),jQuery(function(e){window.BranchItemController=Spine.Controller.create({elements:{".dropdown-menu":"dropdownMenu"},events:{"click .ops li":"doAction"},proxied:["remove","render","update"],template:function(t){return e("#branch-item-tmpl").tmpl(t)},init:function(){e("#branches").bind("branches:update",this.update)},update:function(t,n){e(n.el).attr("id")==this.el.attr("id")&&(this.render(e(n.el)),this.App.trigger("branches:update"))},render:function(e){return this.el.replaceWith(e),this},remove:function(){this.el.remove()},doAction:function(t){return this.currentAnchor=e(t.currentTarget),this.dropdownMenu.find("li.active").removeClass("active"),this.current=e(t.currentTarget).closest("li"),this.current.addClass("active"),action=this.current.data("action"),console.log("action",action),this.App.trigger(action,this.current.attr("data-url"),this.current),this.currentAnchor.closest(".actions").removeClass("open"),!1}})}),jQuery(function(e){window.Trees=Spine.Controller.create({elements:{"#branches":"branchesEl","#all":"allBranches"},events:{},proxied:[],init:function(){this.items=[],this.empty=!1,this.App.bind("show:tab:latest_issues",this.showLatest),this.allBranchesUrl=this.allBranches.data("collection_url"),console.log("collection_url=>",this.allBranchesUrl),this.all=BranchList.init({el:this.allBranches,itemCollectionUrl:this.allBranchesUrl}),this.editBranch=EditBranch.init({el:e("#editView")})},showLatest:function(){this.latest.show(),this.currentController=this.latest},template:function(){},show:function(){},showProgress:function(t){this.hideProgress(),this.progress=e("#progress-tmpl").tmpl(t),this.progress.appendTo(this.content)},hideProgress:function(){this.progress.remove()},checkScroll:function(){}})}),jQuery(function(e){Spine.Controller.prototype.App.activate=function(e){this.current=e,console.log("activate",this.current)},Spine.Controller.prototype.App.deactivate=function(e){this.previous=e},window.Application=Spine.Controller.create({elements:{"#newBranchTrigger":"newBranchAnchor"},events:{"click #newBranchTrigger":"showNewBranch"},proxied:["activate","deactivate","scroll","onConnect","onFailure","onAttach"],template:function(){},init:function(){this.App.bind("activate",this.activate),this.App.bind("deactivate",this.deactivate),this.newBranch=NewBranch.init({el:e("#newBranchDialog")}),this.trees=Trees.init({el:e("#app")}),this.current=this.newBranch,this.current.show()},showNewBranch:function(){this.newBranch.activate(),this.current=this.newBranch}}),Application.init({el:e("body")})});